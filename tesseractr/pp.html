<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tesseract.js Image Recognition</title>
</head>
<body>
  <h1>Tesseract.js Image Recognition</h1>

  <input type="file" id="imageInput" multiple>
  <button onclick="runRecognition()">Run Recognition</button>

  <script>
    async function runRecognition() {
      const { createWorker } = Tesseract;
      const imageInput = document.getElementById('imageInput');
      const files = imageInput.files;

      if (files.length === 0) {
        alert('Please select at least one image.');
        return;
      }

      const numberOfWorkers = 10;
      const workers = await Promise.all(Array(numberOfWorkers).fill(0).map(async (_, index) => {
        const worker = createWorker({
          workerPath: 'https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/worker.min.js',
          langPath: 'https://cdn.jsdelivr.net/npm/tesseract.js@5/lang/',
          corePath: 'https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract-core.wasm.js',
        });
        // Set up logging directly on the worker object
        worker.logger = (info) => console.log(`Worker ${index + 1}:`, info);
        return { worker, index };
      }));

      const imagePaths = Array.from(files).map(file => URL.createObjectURL(file));

      const results = await Promise.all(imagePaths.map(async (imagePath, index) => {
        const workerIndex = index % numberOfWorkers;
        const { data } = await workers[workerIndex].worker.recognize(imagePath);
        return { index, workerIndex, data };
      }));

      console.log(results);

      // Terminate workers
      workers.forEach(({ worker }) => worker.terminate());
    }
  </script>
</body>
</html>
